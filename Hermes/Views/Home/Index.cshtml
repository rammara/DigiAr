@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center">
    <h1 class="display-4">Тестовое задание</h1>
</div>




<div class="row mt-2">
    <div class="col-5 offset-1">
        <h4>Получение котировок:</h4>
        <form class="form" id="formStoreQuote" method="post">
            <label for="inputExchange">Биржа:</label>
            <input type="text" class="form-control form-control-sm" id="inputExchange" name="exhcange" value="@TempData["ExchangeUrl"]" />
            <label for="inputStorage">Хранилище:</label>
            <input type="text" class="form-control form-control-sm" id="inputStorage" name="storage" value="@TempData["StorageUrl"]" />

            <label for="inputName">Введите имя котировки:</label>
            <input type="text" class="form-control form-control-sm" id="inputName" name="name" required placeholder="Введите имя котировки" />
            <button class="btn btn-primary mt-1" type="submit" id="btnSubmit">Получить</button>
        </form>
        <div id="result"></div>
    </div>
    <div class="col-5 offset-1">
        <h4 id="sentQuotes">Отправленные котировки</h4>
        <ul id="quoteList"></ul>
    </div>
</div>

<script type="text/javascript">
    document.getElementById('formStoreQuote').addEventListener('submit', function (event) {
        event.preventDefault(); 

        const inputName = document.getElementById('inputName');
        const resultDiv = document.getElementById('result');
        const quoteList = document.getElementById('quoteList');

        if (inputName.value.trim() === '') {
            alert('Пожалуйста, введите имя котировки.');
            return;
        }
        resultDiv.style.display = 'none';
        fetch('Home/StoreQuote', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: new URLSearchParams(new FormData(this)) 
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Ошибка отправки: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log(data); 
                const li = document.createElement('li');
                li.textContent = `${data.name}: ${data.price}`;
                quoteList.appendChild(li);
                resultDiv.innerHTML = `<strong>Котировка успешно получена!</strong><br>Имя: ${data.name}<br>Цена: ${data.price}`;
                resultDiv.style.display = 'block'; 
            })
            .catch(error => {
                console.error('There has been a problem with your fetch operation:', error);
                resultDiv.innerHTML = '<strong>Ошибка при получении котировки.</strong>';
                resultDiv.style.display = 'block'; 
            });
    });

</script>

